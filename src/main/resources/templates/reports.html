<!DOCTYPE html>
<html lang="it" xmlns="www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verbali ¬∑ MyPoliHub</title>

    <link rel="stylesheet" href="/css/adminPanel.css" />
    <link rel="stylesheet" th:href="@{/css/home.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/reports.css(v=${#dates.createNow().time})}">
</head>

<body>
    <div class="container home-shell">

        <!-- TOPBAR -->
        <header class="topbar home-topbar">
            <div class="brand">
                <div class="logo">MP</div>
                <div class="title">
                    <h1>MyPoliHub</h1>
                    <span th:text="|Ciao ${helloName} üëã|">Ciao üëã</span>
                </div>
            </div>

            <div class="quick-actions">
                <a class="btn btn-accent" th:href="@{/home}">
                    <span class="icon orange"></span> Home
                </a>
                <a class="btn btn-accent" th:href="@{/professor/reports}">
                    <span class="icon purple"></span> Verbali
                </a>
                <a class="btn" th:href="@{/logout}">
                    <span class="icon"></span> Logout
                </a>
            </div>
        </header>

        <!-- HERO -->
        <section class="hero">
            <div class="hero-left">
                <div class="hero-pill">
                    <span class="dot"></span>
                    <span th:text="|Dashboard ${role != null ? role : ''}|">Dashboard</span>
                </div>

                <h2 class="hero-title">Verbali</h2>
                <p class="hero-sub">
                    Seleziona un corso e premi <strong>Mostra verbali</strong>: i verbali verranno caricati e mostrati
                    <strong>solo sotto il corso selezionato</strong>.
                </p>
            </div>

            <aside class="hero-right">
                <div class="stat-card">
                    <div class="stat-top">
                        <div class="stat-title">Totale corsi</div>
                        <div class="stat-badge" th:text="${courses != null ? courses.size() : 0}">0</div>
                    </div>
                    <div class="stat-sub">Corsi associati al tuo profilo</div>
                </div>

                <div class="stat-card">
                    <div class="stat-top">
                        <div class="stat-title">Verbali caricati</div>
                        <div class="stat-badge" th:text="${reports != null ? reports.size() : 0}">0</div>
                    </div>
                    <div class="stat-sub">
                        Mostrati solo quando selezioni un corso
                    </div>
                </div>
            </aside>
        </section>

        <!-- MAIN -->
        <main class="main-grid">

            <!-- COURSES -->
            <section class="card courses-card">
                <div class="card-header">
                    <div>
                        <h2 class="card-title">Verbali per corso</h2>
                        <p class="card-sub">
                            Premi ‚ÄúMostra verbali‚Äù su un corso per caricare e visualizzare la lista.
                        </p>
                    </div>

                    <span class="pill" th:text="|Corsi: ${courses != null ? courses.size() : 0}|">Corsi: 0</span>
                </div>

                <div class="card-body">

                    <div class="note" th:if="${courses == null or courses.isEmpty()}">
                        Nessun corso disponibile.
                    </div>

                    <div id="coursesGrid" class="courses-grid" th:if="${courses != null and !courses.isEmpty()}">
                        <article class="course-card" th:each="c : ${courses}" th:id="|course-${c.id}|"
                            th:classappend="${selectedCourseId != null and selectedCourseId == c.id} ? ' is-selected' : ''">

                            <div class="course-accent"></div>

                            <div class="course-head">
                                <div class="course-head-left">
                                    <h3 class="course-name" th:text="${c.name}">Nome corso</h3>

                                    <div class="course-badges">
                                        <span class="badge">
                                            <span class="chip-ico"></span>
                                            <span th:text="|${c.cfu} CFU|">0 CFU</span>
                                        </span>

                                        <span class="badge badge-soft">
                                            <span class="chip-ico purple"></span>
                                            <span
                                                th:text="${c.semester != null ? c.semester + ' SEMESTRE' : '‚Äî'}">Semestre</span>
                                        </span>

                                        <span class="badge badge-soft">
                                            <span class="chip-ico orange"></span>
                                            <span
                                                th:text="${c.professor != null ? (c.professor.name + ' ' + c.professor.surname) : '‚Äî'}">Docente</span>
                                        </span>

                                        <!-- LOAD REPORTS ONLY WHEN CLICKED -->
                                        <a class="btn btn-accent" style="padding: 9px 12px;"
                                            th:href="@{/professor/reports(courseId=${c.id})} + '#course-' + ${c.id}">
                                            <span class="icon"></span> Mostra Verbali
                                        </a>

                                        <!-- OPTIONAL: close/hide -->
                                        <a class="btn btn-ghost" style="padding: 9px 12px;"
                                            th:if="${selectedCourseId != null and selectedCourseId == c.id}"
                                            th:href="@{/professor/reports} + '#course-' + ${c.id}">
                                            Chiudi
                                        </a>
                                    </div>
                                </div>

                                <div class="course-kpi">
                                    <div class="k">
                                        <!-- reports √® gi√† filtrato per courseId dal controller -->
                                        <div class="num"
                                            th:text="${(selectedCourseId != null and selectedCourseId == c.id and reports != null) ? reports.size() : 0}">
                                            0
                                        </div>
                                        <div class="txt">Verbali</div>
                                    </div>
                                </div>
                            </div>

                            <!-- DETAILS -->
                            <details class="course-details"
                                th:open="${selectedCourseId != null and selectedCourseId == c.id}">
                                <summary>
                                    <span class="summary-left">
                                        <span class="chev"></span>
                                        Dettagli
                                    </span>
                                </summary>

                                <div class="details-body">

                                    <div class="details-row">
                                        <div class="details-label">Docente</div>
                                        <div class="details-value"
                                            th:text="${c.professor != null ? (c.professor.name + ' ' + c.professor.surname) : '‚Äî'}">
                                            ‚Äî
                                        </div>
                                    </div>

                                    <div class="details-row" th:if="${c.majors != null and !c.majors.isEmpty()}">
                                        <div class="details-label">Percorso</div>
                                        <div class="details-value">
                                            <div th:each="m : ${c.majors}">
                                                <span th:text="${m != null ? m.name : '‚Äî'}">‚Äî</span> ¬∑
                                                <span
                                                    th:text="${m != null && m.degreeLevel != null ? m.degreeLevel.name : '‚Äî'}">‚Äî</span>
                                                <br>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="exam-block">
                                        <div class="exam-head">
                                            <div class="details-label">Verbali disponibili</div>

                                            <span class="mini-pill"
                                                th:text="${(selectedCourseId != null and selectedCourseId == c.id and reports != null) ? reports.size() : 0}">
                                                0
                                            </span>
                                        </div>

                                        <!-- If course NOT selected -> show hint -->
                                        <div class="note"
                                            th:if="${selectedCourseId == null or selectedCourseId != c.id}">
                                            Premi ‚ÄúMostra verbali‚Äù per caricare la lista.
                                        </div>

                                        <!-- If selected -> show list -->
                                        <div th:if="${selectedCourseId != null and selectedCourseId == c.id}">
                                            <div class="exam-list" th:if="${reports != null and !reports.isEmpty()}">

                                                <a class="exam-item" th:each="r : ${reports}"
                                                    th:href="@{/professor/reports(courseId=${c.id}, reportId=${r.id})}">

                                                    <div class="exam-date"
                                                        th:text="|Appello del ${#temporals.format(r.exam.date, 'dd/MM/yyyy')} \ Verbale del ${#temporals.format(r.timestamp, 'dd/MM/yyyy HH:mm')}|">
                                                        01/01/2026
                                                    </div>

                                                    <div class="exam-time"
                                                        th:text="${#temporals.format(r.exam.date, 'HH:mm')}">
                                                        10:30
                                                    </div>

                                                    <div class="exam-cta" th:text="|Verbale #${r.id}|">
                                                        Apri
                                                    </div>
                                                </a>
                                            </div>

                                            <div class="note" style="margin-top:10px;"
                                                th:if="${reports == null or reports.isEmpty()}">
                                                Nessun verbale disponibile per questo corso.
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </details>
                        </article>
                    </div>
                </div>
            </section>

            <!-- SIDE -->
            <aside class="side-col">
                <section class="card mini side-card">
                    <h3>Come funziona</h3>
                    <p class="note">
                        Seleziona un corso ‚Üí premi ‚ÄúMostra verbali‚Äù ‚Üí i verbali vengono caricati solo per quel corso.
                    </p>
                </section>

                <section class="card mini side-card">
                    <h3>Stato</h3>
                    <div class="kpi">
                        <div class="box">
                            <div class="num" th:text="${courses != null ? courses.size() : 0}">0</div>
                            <div class="txt">Corsi</div>
                        </div>
                        <div class="box">
                            <div class="num" th:text="${reports != null ? reports.size() : 0}">0</div>
                            <div class="txt">Caricati</div>
                        </div>
                    </div>
                </section>
            </aside>

        </main>

    </div>
</body>

</html>